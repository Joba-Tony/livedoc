# 地图配置文件说明

本文档基于服务器端代码 `HGServer/Game.cpp` 中的 `__bReadMapInfo()` 函数分析整理。

## 文件格式

地图配置文件为纯文本格式，以 `[MAP-INFO]` 开始，以 `[END-MAP-INFO]` 结束。
- 使用 `=` 分隔配置项和值
- 支持 `//` 注释

---

## 基础配置项

### map-location
**用途**: 地图所属位置/阵营  
**格式**: `map-location = <位置名>`  
**示例**: 
```
map-location = aresden      // 属于Aresden阵营
map-location = elvine       // 属于Elvine阵营
map-location = middleland   // 中立地带
map-location = BtField      // 战场地图
```
**说明**: 此配置决定地图的归属阵营，影响PVP规则和传送逻辑。

---

### initial-point
**用途**: 玩家出生点/复活点坐标  
**格式**: `initial-point = <编号> <X坐标> <Y坐标>`  
**示例**:
```
initial-point = 1  140 49
initial-point = 2  68 125
initial-point = 3  170 145
```
**说明**: 可以配置多个出生点，编号从1开始。玩家死亡复活或传送进入时会随机选择一个出生点。

---

### maximum-object
**用途**: 地图最大对象数量限制  
**格式**: `maximum-object = <数量>`  
**示例**: `maximum-object = 300`  
**说明**: 限制地图上同时存在的对象(NPC、怪物、物品等)总数。

---

### level-limit
**用途**: 进入地图的最低等级限制  
**格式**: `level-limit = <等级>`  
**示例**: `level-limit = 20`  
**说明**: 低于此等级的玩家无法进入该地图。

---

### upper-level-limit
**用途**: 进入地图的最高等级限制  
**格式**: `upper-level-limit = <等级>`  
**示例**: `upper-level-limit = 100`  
**说明**: 高于此等级的玩家无法进入该地图。

---

### CitizenLimit
**用途**: 是否限制为公民才能进入  
**格式**: `CitizenLimit = <0或1>`  
**示例**: `CitizenLimit = 1`  
**说明**: 
- `0`: 所有玩家可进入
- `1`: 仅公民(已加入阵营)可进入

---

### MapZoneLevel
**用途**: 地图区域等级  
**格式**: `MapZoneLevel = <等级>`  
**示例**: `MapZoneLevel = 1`  
**说明**: 用于区分不同危险等级的区域，影响某些游戏机制。

---

### exp-double
**用途**: 经验倍率  
**格式**: `exp-double = <倍率>`  
**示例**: `exp-double = 1.5`  
**说明**: 在该地图获得的经验值会乘以此倍率。

---

### fixed-dayornight-mode
**用途**: 固定白天/黑夜模式  
**格式**: `fixed-dayornight-mode = <0或1>`  
**示例**: `fixed-dayornight-mode = 1`  
**说明**: 
- `0`: 跟随服务器昼夜循环
- `1`: 固定为白天模式(同时禁用下雪效果)

---

### CanSummonPet
**用途**: 是否允许召唤宠物  
**格式**: `CanSummonPet = <0或1>`  
**示例**: `CanSummonPet = 0`  
**说明**: 
- `0`: 禁止召唤宠物
- `1`: 允许召唤宠物

---

## 传送配置

### teleport-loc
**用途**: 定义地图上的传送点  
**格式**: `teleport-loc = <源X> <源Y> <目标地图名> <目标X> <目标Y> <朝向>`  
**示例**:
```
teleport-loc = 135 129 cityhall_1 55 44 6
teleport-loc = 27  20  middleland 152 500 1
```
**参数说明**:
- `源X, 源Y`: 触发传送的坐标位置
- `目标地图名`: 传送目的地地图名称
- `目标X, 目标Y`: 目的地坐标 (`-1 -1` 表示随机位置)
- `朝向`: 传送后的面朝方向 (1-8，对应8个方向)

**朝向说明**:
```
    8  1  2
     \ | /
  7 - + - 3
     / | \
    6  5  4
```

---

## 路径点配置

### waypoint
**用途**: 定义NPC/怪物的巡逻路径点  
**格式**: `waypoint = <编号> <X坐标> <Y坐标>`  
**示例**:
```
waypoint = 0  60 55
waypoint = 1  140 60
waypoint = 2  250 75
```
**说明**: 编号从0开始，最多10个路径点(0-9)。用于spot-mob-generator的Type 2模式。

---

## 怪物生成配置

### spot-mob-generator
**用途**: 定义区域怪物刷新  
**格式**: `spot-mob-generator = <编号> <类型> <区域/路径点> <怪物ID> <数量>`  
**示例**:
```
// Type 1: 区域刷怪 (RECT模式)
spot-mob-generator = 1  1  246 66 266 79  17  10   // 在矩形区域内刷10只ID为17的怪物

// Type 2: 路径点刷怪 (Waypoint模式) - 需要10个路径点编号
spot-mob-generator = 1  2  0 1 2 3 4 5 6 7 8 9  17  10
```
**参数说明**:
- `编号`: 刷怪点编号
- `类型`: 
  - `1`: 矩形区域刷怪，后接4个数字定义区域 (left, top, right, bottom)
  - `2`: 路径点刷怪，后接10个路径点编号
- `怪物ID`: NPC配置文件中的怪物ID
- `数量`: 最大同时存在的怪物数量

---

### random-mob-generator
**用途**: 随机怪物生成器  
**格式**: `random-mob-generator = <开关> <等级>`  
**示例**: `random-mob-generator = 1 18`  
**说明**: 
- 第一个参数为开关(0/1)
- 第二个参数为怪物等级

---

## 区域限制配置

### no-attack-area
**用途**: 定义禁止攻击区域(安全区)  
**格式**: `no-attack-area = <编号> <左> <上> <右> <下>`  
**示例**: `no-attack-area = 1 164 166 172 174`  
**说明**: 在此矩形区域内，玩家无法进行攻击操作。

---

### npc-avoidrect
**用途**: NPC生成避开区域  
**格式**: `npc-avoidrect = <编号> <左> <上> <右> <下>`  
**示例**: `npc-avoidrect = 1 76 70 209 219`  
**说明**: 随机生成NPC时会避开此区域。

---

## 钓鱼配置

### max-fish
**用途**: 地图最大鱼数量  
**格式**: `max-fish = <数量>`  
**示例**: `max-fish = 25`

### fish-point
**用途**: 定义钓鱼点位置  
**格式**: `fish-point = <编号> <X坐标> <Y坐标>`  
**示例**:
```
fish-point = 0  59 99
fish-point = 1  60 98
```

---

## 矿物配置

### mineral-generator
**用途**: 矿物生成器  
**格式**: `mineral-generator = <开关> <等级>`  
**示例**: `mineral-generator = 1 2`

### max-mineral
**用途**: 最大矿物数量  
**格式**: `max-mineral = <数量>`  
**示例**: `max-mineral = 10`

### mineral-point
**用途**: 矿物生成点  
**格式**: `mineral-point = <编号> <X坐标> <Y坐标>`  
**示例**: `mineral-point = 0 100 150`

---

## 特殊NPC配置

### SpecialNPC
**用途**: 是否启用特殊NPC生成  
**格式**: `SpecialNPC = <0或1>`  
**示例**: `SpecialNPC = 1`  
**说明**: 启用后，地图会定期刷新特殊NPC(精英怪)。

### SpecNpcElapse
**用途**: 特殊NPC刷新间隔(秒)  
**格式**: `SpecNpcElapse = <秒数>`  
**示例**: `SpecNpcElapse = 3600`  
**说明**: 特殊NPC被击杀后，经过此时间后重新刷新。

---

## Heldenian战争相关配置

### HeldenianMap
**用途**: 标记为Heldenian战争地图  
**格式**: `HeldenianMap = 1`  
**说明**: 标记此地图参与Heldenian战争系统。

### HeldenianModeMap
**用途**: Heldenian战争模式地图  
**格式**: `HeldenianModeMap = 1`  
**说明**: 主战场地图标记(如BtField)。

### HeldenianWinningZone
**用途**: Heldenian胜利区域  
**格式**: `HeldenianWinningZone = <X坐标> <Y坐标>`  
**示例**: `HeldenianWinningZone = 59 72`  
**说明**: 控制此区域可获得战争胜利。

### HeldenianTower
**用途**: 定义Heldenian防御塔位置  
**格式**: `HeldenianTower = <塔类型ID> <阵营> <X坐标> <Y坐标>`  
**示例**: 
```
HeldenianTower = 87  1  53 212   // 阵营1的87号塔，位于(53,212)
HeldenianTower = 89  1  48 210   // 阵营1的89号塔
```
**说明**: 
- 塔类型ID对应NPC配置中的防御塔类型
- 阵营: 1=Aresden, 2=Elvine

### HeldenianGateDoor
**用途**: 定义Heldenian城门位置  
**格式**: `HeldenianGateDoor = <方向> <X坐标> <Y坐标>`  
**示例**:
```
HeldenianGateDoor = 3  98 49
HeldenianGateDoor = 3  134 73
```
**说明**: 方向值与朝向相同(1-8)。

---

## 战略点配置

### strategic-point
**用途**: 定义战略据点  
**格式**: `strategic-point = <编号> <阵营> <价值> <X坐标> <Y坐标>`  
**示例**: `strategic-point = 1 0 100 150 200`  
**说明**: 用于十字军战争等大型活动的据点控制。

---

## 能量球配置

### energy-sphere-creation-point
**用途**: 能量球生成点  
**格式**: `energy-sphere-creation-point = <编号> <类型> <X坐标> <Y坐标>`

### energy-sphere-goal-point
**用途**: 能量球目标点  
**格式**: `energy-sphere-goal-point = <编号> <结果> <AresdenX> <AresdenY> <ElvineX> <ElvineY>`

---

## 打击点配置

### strike-point
**用途**: 定义可攻击的战略目标点  
**格式**: `strike-point = <编号> <X坐标> <Y坐标> <HP> <效果点1-5的X,Y坐标> <关联地图名>`  
**说明**: 用于十字军战争等活动中的攻击目标。

---

## 动态门配置

### DynamicGateType
**用途**: 动态传送门类型  
**格式**: `DynamicGateType = <类型>`  
**示例**: `DynamicGateType = 1`

### DynamicGateCoord
**用途**: 动态传送门坐标  
**格式**: `DynamicGateCoord = <左> <上> <右> <下> <目标地图> <目标X> <目标Y>`  
**示例**: `DynamicGateCoord = 89 31 90 32 druncncity -1 -1`

---

## 特殊地图配置

### ApocalypseMobGenType
**用途**: 天启怪物生成类型  
**格式**: `ApocalypseMobGenType = 1`

### ApocalypseMap
**用途**: 标记为天启地图  
**格式**: `ApocalypseMap = 1`

### RecallImpossible
**用途**: 禁止使用回城术  
**格式**: `RecallImpossible = 1`

---

## 完整配置示例

### 城镇地图 (aresden.txt)
```
[MAP-INFO]
map-location  = aresden
initial-point = 1  140 49
initial-point = 2  68 125

teleport-loc = 135 129 cityhall_1 55 44 6
teleport-loc = 27  20  middleland 152 500 1

waypoint = 0  60 55
waypoint = 1  140 60

no-attack-area = 1 136 46 145 53

maximum-object = 300

spot-mob-generator = 1  1  246 66 266 79  17  10

max-fish = 25
fish-point = 0  59 99

[END-MAP-INFO]
```

### 战场地图 (HRampart.txt)
```
[MAP-INFO]
map-location  = HRampart
level-limit   = 1
CitizenLimit  = 0
HeldenianMap  = 1

initial-point = 1  120 120

teleport-loc = 43 39 GodH 455 204 3

HeldenianGateDoor = 3  98 49
HeldenianGateDoor = 3  134 73

maximum-object = 999

spot-mob-generator = 1  1  20 52 170 155  82  10

[END-MAP-INFO]
```

### 练级地图 (middleland.txt)
```
[MAP-INFO]
map-location  = middleland
initial-point = 1  192 228
level-limit   = 20
CitizenLimit  = 1
MapZoneLevel  = 1

teleport-loc = 147 503 aresden 30 23 5
teleport-loc = 99  20  elvine  25 274 1

waypoint = 0  50 140
waypoint = 1  135 105

maximum-object = 300

spot-mob-generator = 1  1  100 100 200 200  31  20

[END-MAP-INFO]
```

---

## 地图类型说明

根据代码，地图类型(`m_cType`)会根据地图名称自动设置：

| 地图名前缀 | 类型值 | 说明 |
|-----------|--------|------|
| fightzone | DEF_MAPTYPE_FIGHTZONE | 竞技场地图 |
| bisle | DEF_MAPTYPE_NOPENALTY_NOREWARD | 无惩罚无奖励 |
| Arena | DEF_MAPTYPE_NOPENALTY_NOREWARD | 无惩罚无奖励 |
| aresdenx | DEF_MAPTYPE_NEWMAPDROPBOX | 新地图掉落宝箱 |
| elvinex | DEF_MAPTYPE_NEWMAPDROPBOX | 新地图掉落宝箱 |
| icebound | - | 启用下雪效果 |

---

## 注意事项

1. 所有坐标均为地图格子坐标，不是像素坐标
2. 编号通常从0或1开始，具体看配置项
3. 矩形区域格式统一为 `left top right bottom`
4. 配置文件名必须与地图名一致（不区分大小写）
5. 确保 `[END-MAP-INFO]` 标记存在，否则解析会报错
