# 荣誉(JJCScore)系统详解

## 一、概述

荣誉系统是游戏中的**军衔显示**和**竞技场排名**系统，玩家通过3C竞技场、国战排名等方式获取荣誉值，荣誉值决定显示的军衔称号（列兵、军士、元帅等）。

> ⚠️ **注意区分**：荣誉(`m_sJJCScore`)和贡献度(`m_iContribution`)是两个完全不同的系统！
> - **荣誉**：决定**军衔显示**（列兵、军士、元帅等），显示在角色名旁边
> - **贡献度**：影响**战斗属性**（物理/魔法伤害加成、伤害减免）

**关键代码位置：**
- 变量定义：`HGServer/Client.h` 第290行 (`m_sJJCScore`)
- 军衔名称：`HGClient/Game.cpp` 第561-573行 (`m_strJJCRankName`)
- 军衔计算：`HGClient/Game.cpp` 第40516行 (`iGetJJCRankLevel`)
- 修改函数：`HGServer/3Channel.cpp` 第275行 (`ModifyPlayerJJCScore`)

**荣誉范围：** `0` ~ `20000` (`DEF_MAX_JJCSCORE = 20000`)

---

## 二、军衔等级与所需荣誉对照表

| 等级 | 军衔名称 | 所需荣誉 | 荣誉区间 |
|:----:|:--------:|:--------:|:--------:|
| 0 | 列兵 | 0 | 0 ~ 49 |
| 1 | 军士 | 50 | 50 ~ 149 |
| 2 | 军士长 | 150 | 150 ~ 299 |
| 3 | 士官长 | 300 | 300 ~ 499 |
| 4 | 骑士守卫 | 500 | 500 ~ 799 |
| 5 | 骑士队长 | 800 | 800 ~ 1199 |
| 6 | 司令 | 1200 | 1200 ~ 1699 |
| 7 | 统帅 | 1700 | 1700 ~ 2299 |
| 8 | 元帅 | 2300 | 2300 ~ 3199 |
| 9 | 大元帅 | 3200 | 3200 ~ 4999 |
| 10 | 大元帅★ | 5000 | 5000 ~ 9999 |
| 11 | 大元帅★★ | 10000 | 10000 ~ 11999 |
| 12 | 大元帅★★★ | 12000 | 12000 ~ 20000 |

**显示格式**：`阿瑞登元帅` 或 `爱芬大元帅★★★`

---

## 三、荣誉等级增益效果

荣誉等级(JJCRankLevel)会影响**附魔装备**的效果，军衔越高，附魔属性的增益越强。

> **代码位置**：[Game.cpp#L43179-43223](HGServer/Game.cpp#L43179-L43223)

### 3.1 附魔伤害增益

**计算公式：**
```
最终附魔伤害 = 基础值 + 基础值 / 100.0 × 荣誉等级 × 6
```

**基础值（默认配置）：**
| 附魔等级 | 基础伤害值 | 配置项 |
|:--------:|:----------:|:------:|
| 1级(初级) | 2 | s41LowDamageValue |
| 2级(中级) | 5 | s42MiddleDamageValue |
| 3级(高级) | 8 | s43HighDamageValue |

**荣誉等级加成示例（3级高级附魔，基础值8）：**
| 荣誉等级 | 军衔 | 额外伤害 | 最终附魔伤害 |
|:--------:|:----:|:--------:|:------------:|
| 0 | 列兵 | +0 | 8 |
| 6 | 司令 | +3 | 11 |
| 8 | 元帅 | +4 | 12 |
| 10 | 大元帅★ | +5 | 13 |
| 12 | 大元帅★★★ | +6 | 14 |

### 3.2 附魔命中增益

**计算公式：**
```
最终附魔命中 = 基础值 + 基础值 / 100.0 × 荣誉等级 × 6
```

**基础值（默认配置）：**
| 附魔等级 | 基础命中值 | 配置项 |
|:--------:|:----------:|:------:|
| 1级(初级) | 10 | s44LowRatioValue |
| 2级(中级) | 20 | s45MiddleRatioValue |
| 3级(高级) | 50 | s46HighRatioValue |

**荣誉等级加成示例（3级高级附魔，基础值50）：**
| 荣誉等级 | 军衔 | 额外命中 | 最终附魔命中 |
|:--------:|:----:|:--------:|:------------:|
| 0 | 列兵 | +0 | 50 |
| 6 | 司令 | +18 | 68 |
| 8 | 元帅 | +24 | 74 |
| 10 | 大元帅★ | +30 | 80 |
| 12 | 大元帅★★★ | +36 | 86 |

### 3.3 附魔物理防御增益

**计算公式：**
```
最终附魔防御 = 基础值 + 基础值 / 30.0 × 荣誉等级
```

> ⚠️ **限制**：力量(STR) ≥ 120 时，附魔物理防御无效

**基础值（默认配置）：**
| 附魔等级 | 基础防御值 | 配置项 |
|:--------:|:----------:|:------:|
| 1级(初级) | 10 | s47LowPDefenceValue |
| 2级(中级) | 20 | s48MiddlePDefenceValue |
| 3级(高级) | 30 | s49HighPDefenceValue |

**荣誉等级加成示例（3级高级附魔，基础值30）：**
| 荣誉等级 | 军衔 | 额外防御 | 最终附魔防御 |
|:--------:|:----:|:--------:|:------------:|
| 0 | 列兵 | +0 | 30 |
| 6 | 司令 | +6 | 36 |
| 8 | 元帅 | +8 | 38 |
| 10 | 大元帅★ | +10 | 40 |
| 12 | 大元帅★★★ | +12 | 42 |

---

## 四、荣誉获取方式一览表

### 📊 完整获取方式

| 方式 | 荣誉 | 是否乘倍率 | 代码位置 |
|:----:|:--------:|:--------:|:-----|
| **3C竞技场击杀敌人** | +1 | ✅乘倍率 | [Game.cpp#L21435](HGServer/Game.cpp#L21435) |
| **3F竞技场击杀敌人** | +1 | ✅乘倍率 | [Game.cpp#L21487](HGServer/Game.cpp#L21487) |
| **国战击杀敌人** | +1 | ❌不乘 | [Game.cpp#L21667](HGServer/Game.cpp#L21667) |
| **3C建造防御塔** | +5 | ✅乘倍率 | [NewPartySystem.cpp#L2445](HGServer/NewPartySystem.cpp#L2445) |
| **3C修复基地塔** | +8 | ✅乘倍率 | [NewPartySystem.cpp#L2479](HGServer/NewPartySystem.cpp#L2479) |
| **3C摧毁敌方城门(AGT/CGT)** | +5 | ✅乘倍率 | [Game.cpp#L16999](HGServer/Game.cpp#L16999) |
| **国战摧毁敌方城门(AGT/CGT)** | +5 | ✅乘倍率 | [Game.cpp#L16999](HGServer/Game.cpp#L16999) |
| **国战参与奖励(胜方)** | +15 | ✅乘倍率 | [NewPartySystem.cpp#L28483](HGServer/NewPartySystem.cpp#L28483) |
| **国战参与奖励(败方)** | +8 | ✅乘倍率 | [NewPartySystem.cpp#L28487](HGServer/NewPartySystem.cpp#L28487) |
| **3C结算奖励(胜方队伍)** | +10 | ✅乘倍率 | [Game.cpp#L17077](HGServer/Game.cpp#L17077) |
| **3C结算奖励(败方队伍)** | +6 | ✅乘倍率 | [Game.cpp#L17078](HGServer/Game.cpp#L17078) |
| **3F结算奖励(胜方队伍)** | +10 | ✅乘倍率 | [3Flags.cpp#L768](HGServer/3Flags.cpp#L768) |
| **3F结算奖励(败方队伍)** | +6 | ✅乘倍率 | [3Flags.cpp#L769](HGServer/3Flags.cpp#L769) |
| **荣誉勋章(5)** | +5 | ❌固定 | [Game.cpp#L36265](HGServer/Game.cpp#L36265) ItemID:471 |
| **荣誉勋章(10)** | +10 | ❌固定 | [Game.cpp#L36265](HGServer/Game.cpp#L36265) ItemID:472 |
| **荣誉勋章(15)** | +15 | ❌固定 | [Game.cpp#L36265](HGServer/Game.cpp#L36265) ItemID:473 |
| **荣誉勋章(20)** | +20 | ❌固定 | [Game.cpp#L36265](HGServer/Game.cpp#L36265) ItemID:474 |
| **荣誉直升碗(ID:475)** | 直升到2300 | ❌固定 | [Game.cpp#L36270-36275](HGServer/Game.cpp#L36270-L36275) |
| 竞技场PK赌注(输) | -赌注 | ❌固定 | [NewPartySystem.cpp#L21000](HGServer/NewPartySystem.cpp#L21000) |
| 攻击友方核心建筑 | -10 | ❌固定 | [Game.cpp#L34742](HGServer/Game.cpp#L34742) |

> **倍率说明**：标记“✅乘倍率”的项目，实际获得荣誉 = 基础荣誉 × `m_i3CRankRatio`（服务器配置）

---

## 五、国战排名荣誉奖励

### 5.1 胜利方排名奖励

| 排名 | 荣誉奖励 | 代码位置 |
|:----:|:--------:|:--------:|
| 第1名 | **+12** | [NewPartySystem.cpp#L28811](HGServer/NewPartySystem.cpp#L28811) |
| 第2名 | **+10** | [NewPartySystem.cpp#L28823](HGServer/NewPartySystem.cpp#L28823) |
| 第3名 | **+8** | [NewPartySystem.cpp#L28835](HGServer/NewPartySystem.cpp#L28835) |
| 第4名 | **+7** | [NewPartySystem.cpp#L28847](HGServer/NewPartySystem.cpp#L28847) |
| 第5名 | **+6** | [NewPartySystem.cpp#L28859](HGServer/NewPartySystem.cpp#L28859) |
| 第6名 | **+5** | [NewPartySystem.cpp#L28871](HGServer/NewPartySystem.cpp#L28871) |
| 第7名 | **+4** | [NewPartySystem.cpp#L28883](HGServer/NewPartySystem.cpp#L28883) |

### 5.2 失败方排名奖励

| 排名 | 荣誉奖励 | 代码位置 |
|:----:|:--------:|:--------:|
| 第1名 | **+10** | [NewPartySystem.cpp#L28920](HGServer/NewPartySystem.cpp#L28920) |
| 第2名 | **+8** | [NewPartySystem.cpp#L28932](HGServer/NewPartySystem.cpp#L28932) |
| 第3名 | **+6** | [NewPartySystem.cpp#L28944](HGServer/NewPartySystem.cpp#L28944) |
| 第4名 | **+6** | [NewPartySystem.cpp#L28956](HGServer/NewPartySystem.cpp#L28956) |

---

## 六、3C/3F竞技场荣誉详情

### 6.1 3C结算奖励

3C竞技场结束时，根据胜负获得荣誉奖励：
- **胜利队伍**：每人 +10 × 倍率 → [Game.cpp#L17077](HGServer/Game.cpp#L17077)
- **失败队伍**：每人 +6 × 倍率 → [Game.cpp#L17078](HGServer/Game.cpp#L17078)

### 6.2 3F结算奖励

3F竞技场结束时，根据胜负获得荣誉奖励：
- **胜利队伍**：每人 +10 × 倍率 → [3Flags.cpp#L768](HGServer/3Flags.cpp#L768)
- **失败队伍**：每人 +6 × 倍率 → [3Flags.cpp#L769](HGServer/3Flags.cpp#L769)

---

## 七、荣誉扣除情况

| 行为 | 荣誉变化 | 代码位置 |
|:----:|:--------:|:-----|
| 竞技场PK赌注(输) | -赌注数量 | [NewPartySystem.cpp#L21000-21001](HGServer/NewPartySystem.cpp#L21000-L21001) |
| 攻击友方核心建筑 | **-10** | [Game.cpp#L34742](HGServer/Game.cpp#L34742) |

---

## 八、相关配置参数

| 参数 | 变量名 | 说明 |
|:----:|:------:|:-----|
| 荣誉上限 | 20000 | 最高可达到的荣誉值 |
| 荣誉倍率 | `m_i3CRankRatio` | 3C竞技场荣誉倍数，影响大部分荣誉获取 |
| 荣誉系统开关 | `m_bGuozhanJJC` | 国战是否有荣誉奖励 |
| 荣誉PK赌注开关 | `m_bJJCScorePK` | PK是否可以用荣誉做赌注 |

---

## 九、荣誉与贡献度对比

| 属性 | 荣誉(JJCScore) | 贡献度(Contribution) |
|:----:|:--------------:|:-------------------:|
| 变量名 | `m_sJJCScore` | `m_iContribution` |
| 主要用途 | **军衔显示**、附魔加成 | **战斗属性增益** |
| 显示位置 | 角色名旁边（军衔） | 高级属性面板 |
| 上限 | 20000 | 20000 |
| 下限 | 0 | -20000 |
| 主要来源 | 3C竞技场、国战排名 | 击杀敌国玩家、道具 |
| 战斗属性影响 | **附魔效果加成** | **有**（伤害加成/减免） |

---

## 十、注意事项

1. **荣誉** (`m_sJJCScore`) 和 **贡献度** (`m_iContribution`) 是两个完全不同的系统
2. **军衔显示**（列兵、军士、元帅等）是根据**荣誉值**计算的，不是贡献度
3. **直接战斗属性增益**（伤害加成/减免）是根据**贡献度**计算的，不是荣誉
4. **荣誉等级会影响附魔装备的效果**，军衔越高，附魔属性加成越大
5. 荣誉值不能为负数，最低为0
6. 大部分荣誉获取都会乘以服务器配置的倍率(`m_i3CRankRatio`)
7. 荣誉系统需要服务器开启才有效(`m_bGuozhanJJC`、`m_serverNewVerData.s69JjcSystemOpened`)

---

*文档生成时间：2026年1月5日*
*代码版本：基于当前工作区代码分析*
