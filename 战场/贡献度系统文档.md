# 贡献度(Contribution)系统详解

## 一、概述

贡献度系统是游戏中的**战斗属性增益系统**，玩家通过国战、击杀敌方玩家等方式获取贡献度，贡献度越高，战斗中造成的伤害越高、受到的伤害越低。

> ⚠️ **注意区分**：贡献度(`m_iContribution`)和荣誉(`m_sJJCScore`)是两个完全不同的系统！
> - **贡献度**：影响**战斗属性**（物理/魔法伤害加成、伤害减免）
> - **荣誉**：决定**军衔显示**（列兵、军士、元帅等），显示在角色名旁边

**关键代码位置：**
- 增益定义：`HGServer/GlobalDef.h` 第22-25行
- 伤害计算：`HGServer/Game.cpp` 多处（搜索 `DEF_CONTRIBUTION_PER_ATTACK_POINT`）

**贡献度范围：** `-20000` ~ `+20000` (`DEF_MAX_CONTRIBUTION = 20000`)

---

## 二、战斗属性增益详解

### 2.1 物理攻击增益

**计算公式：**
```
额外物理伤害 = 贡献度 / 4000
```

**代码位置：** [Game.cpp#L15709](HGServer/Game.cpp#L15709)

**示例计算：**
| 贡献度 | 额外物理伤害 |
|:------:|:------------:|
| 4000 | +1 |
| 8000 | +2 |
| 12000 | +3 |
| 16000 | +4 |
| 20000 | +5 |

### 2.2 魔法攻击增益

**计算公式：**
```
额外魔法伤害 = 贡献度 / 4000
```

**代码位置：** [Game.cpp#L38150-38151](HGServer/Game.cpp#L38150-L38151)

**特殊说明：** 魔法伤害增益有 **25%概率触发**（`iDice(1,100) > 75`）

**示例计算：**
| 贡献度 | 额外魔法伤害(触发时) |
|:------:|:-------------------:|
| 4000 | +1 |
| 8000 | +2 |
| 12000 | +3 |
| 16000 | +4 |
| 20000 | +5 |

### 2.3 对负贡献度目标的额外伤害

> **代码位置**: [Game.cpp#L15730-15740](HGServer/Game.cpp#L15730-L15740)

当目标玩家贡献度为负数时（叛国者/罪犯），攻击者会获得额外伤害加成：

**计算公式：**
```
额外伤害 = |目标贡献度| / 200
最大额外伤害 = 10
```

**示例计算：**
| 目标贡献度 | 额外伤害 |
|:----------:|:--------:|
| -200 | +1 |
| -500 | +2 |
| -1000 | +5 |
| -2000及以下 | +10 (上限) |

### 2.4 对高贡献度目标的伤害减免

> **代码位置**: [Game.cpp#L15720-15725](HGServer/Game.cpp#L15720-L15725)

当攻击高贡献度目标时，目标方会获得伤害减免（等于减少攻击者的伤害）：

**计算公式：**
```
伤害减免 = 目标贡献度 / 4000
```

**示例计算：**
| 目标贡献度 | 受到伤害减少 |
|:----------:|:------------:|
| 4000 | -1 |
| 8000 | -2 |
| 12000 | -3 |
| 16000 | -4 |
| 20000 | -5 |

---

## 三、贡献度增益汇总表

| 贡献度范围 | 物理伤害加成 | 魔法伤害加成(25%概率) | 受到伤害减免 |
|:----------:|:------------:|:--------------------:|:------------:|
| 0 ~ 3999 | +0 | +0 | -0 |
| 4000 ~ 7999 | +1 | +1 | -1 |
| 8000 ~ 11999 | +2 | +2 | -2 |
| 12000 ~ 15999 | +3 | +3 | -3 |
| 16000 ~ 19999 | +4 | +4 | -4 |
| 20000 | +5 | +5 | -5 |

**注意：** 增益是按贡献度/4000线性计算，与军衔等级无关（军衔是根据荣誉值显示的）。

---

## 四、特殊武器增益

以下武器可以**额外享受贡献度加成**（双重计算）：

### 单手武器
- **KlonessEsterk** (ID: 771)
- **KlonessWand(MS.20)** (ID: 763)
- **KlonessWand(MS.10)** (ID: 764)
- **狂暴之杖(MS.30)** (ID: 698)

### 双手武器
- **KlonessBlade** (ID: 779)
- **暴风之刃** (ID: 775)
- **毁灭之剑** (ID: 776)
- **ID: 770**

使用这些武器时，贡献度增益会被**应用两次**：一次在基础属性计算，一次在伤害计算。

---

## 五、国家差异

**阿瑞登(Aresden)** 和 **爱芬(Elvine)** 两个国家的贡献度增益计算完全相同，无任何差异。

---

## 六、贡献度获取途径

### 📊 贡献度获取方式一览表

| 方式 | 贡献度变化 | 条件/说明 |
|:----:|:----------:|:----------|
| **国战击杀敌国玩家** | 攻击者 **+2**，被杀者 -2 | 国战模式开启时 |
| **经验PK地图击杀敌国玩家** | 攻击者 **+1**，被杀者 -1 | 非国战，经验PK地图 |
| **能量球送入己方传送门** | **+5** | 能量球活动 |
| **使用贡献石** (ItemID:159) | **+100** | 消耗道具 |
| **使用高级贡献石** (ItemID:160) | **+1000** | 消耗道具 |
| **玩家好评** | **+1** | 被其他玩家好评，20分钟冷却 |
| 能量球送入敌方传送门 | -10 | 惩罚 |
| PK同国玩家 | -1 | 杀害友军惩罚 |
| 击杀独角兽(Type 32) | -5 | 杀害神圣生物惩罚 |
| 玩家差评 | -1 | 被其他玩家差评 |
| 购买英雄装备 | -10 ~ -100 | 消费贡献度换装备 |

> ⚠️ **重要说明**：国战中摧毁建筑（城门、防御塔等）获得的是**战争贡献值(m_iWarContribution)**，**不是贡献度**！这是两个完全不同的系统。

---

### 6.1 国战相关

**国战期间贡献度变化：**

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:--------:|
| 击杀敌国玩家 | 攻击者 **+2**，被杀者 **-2** | [Game.cpp#L31756-31757](HGServer/Game.cpp#L31756-L31757) |
| 能量球送入己方传送门 | **+5** | [Game.cpp#L56541](HGServer/Game.cpp#L56541) |
| 能量球送入敌方传送门 | **-10** | [Game.cpp#L56548](HGServer/Game.cpp#L56548) |

**国战击杀敌人时同时获得：**
- 贡献度 +2 → [Game.cpp#L31757](HGServer/Game.cpp#L31757)
- 荣誉 +1 → [Game.cpp#L21667](HGServer/Game.cpp#L21667)

**非国战期间(经验PK地图)：**

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:--------:|
| 击杀敌国玩家 | 攻击者 **+1**，被杀者 **-1** | [Game.cpp#L31749-31750](HGServer/Game.cpp#L31749-L31750) |

### 6.2 其他获取途径

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:----:|
| 使用贡献石(ItemID:159) | **+100** | [Game.cpp#L37214](HGServer/Game.cpp#L37214) |
| 使用高级贡献石(ItemID:160) | **+1000** | [Game.cpp#L37223](HGServer/Game.cpp#L37223) |
| 玩家好评评价 | **+1** | [Game.cpp#L44520](HGServer/Game.cpp#L44520) |
| 玩家差评评价 | **-1** | [Game.cpp#L44519](HGServer/Game.cpp#L44519) |

### 6.3 贡献度消耗（购买英雄装备）

| 装备类型 | 消耗贡献度 | 物品示例 |
|:--------:|:----------:|:--------:|
| 英雄披风 | -100 | Aresden/Elvine HeroCape |
| 英雄头盔(M/W) | -20 | HeroHelm |
| 英雄帽子(M/W) | -20 | HeroCap |
| 英雄盔甲(M/W) | -30 | HeroArmour |
| 英雄长袍(M/W) | -20 | HeroRobe |
| 英雄锁甲(M/W) | -10 | HeroHauberk |
| 英雄护腿(M/W) | -15 | HeroLeggings |

### 6.4 贡献度扣除（惩罚）

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:----:|
| PK同国玩家 | **-1** | [Game.cpp#L31565](HGServer/Game.cpp#L31565) |
| 击杀独角兽(Type 32) | **-5** | [Game.cpp#L16925](HGServer/Game.cpp#L16925) |

---

## 八、相关数值汇总

| 参数 | 数值 | 说明 |
|:----:|:----:|:----:|
| 贡献度上限 | 20000 | 最多能积累的贡献度 |
| 贡献度下限 | -20000 | 最低可达到的贡献度 |
| 每点物理伤害需要贡献度 | 4000 | 贡献度/4000=物理伤害加成 |
| 每点魔法伤害需要贡献度 | 4000 | 贡献度/4000=魔法伤害加成(25%触发) |
| 负贡献度伤害系数 | 200 | \|负贡献度\|/200=额外受到伤害 |
| 战争贡献值上限 | 1000000 | 与荣誉值是不同的系统 |

---

## 九、贡献度与战争贡献值对比

| 属性 | 贡献度(Contribution) | 战争贡献值(WarContribution) |
|:----:|:-------------------:|:--------------------------:|
| 变量名 | `m_iContribution` | `m_iWarContribution` |
| 上限 | 20000 | 1000000 |
| 下限 | -20000 | 0 |
| 持久性 | **永久保存** | **国战开始时归零** |
| 用途 | **战斗属性增益** | 国战排名、战后奖励 |
| 获取来源 | 击杀敌国玩家、道具使用 | 国战摧毁建筑、击杀敌国玩家 |

---

## 十、注意事项

1. **贡献度** (`m_iContribution`) 和 **荣誉** (`m_sJJCScore`) 是两个完全不同的系统
2. **军衔显示**（列兵、军士、元帅等）是根据**荣誉**计算的，不是贡献度
3. **战斗属性增益**（物理/魔法伤害加成）是根据**贡献度**计算的，不是荣誉
4. 贡献度可以为负数（最低-20000），负贡献度会导致被攻击时受到额外伤害
5. 魔法伤害增益只有25%概率触发，物理伤害增益是100%触发
6. **国战中摧毁建筑获得的是战争贡献值，不是贡献度**
7. 贡献度通过击杀敌国玩家获取：国战期间+2，经验PK地图+1

---

*文档生成时间：2025年12月15日*
*文档更新时间：2026年1月6日*
*代码版本：基于当前工作区代码分析*
