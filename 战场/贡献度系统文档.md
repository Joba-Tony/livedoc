# 贡献度(Contribution)系统详解

## 一、概述

贡献度系统是游戏中的军衔/职级系统，玩家通过国战、击杀敌方玩家等方式获取贡献度，达到一定数值后可以获得对应的军衔称号和战斗增益。

> ⚠️ **注意区分**：贡献度(`m_iContribution`)和荣誉(`m_sJJCScore`)是两个不同的系统！
> - **贡献度**：显示在角色名旁边，影响军衔和战斗属性
> - **荣誉**：显示在高级属性面板，用于国战/3C竞技场排名奖励

**关键代码位置：**
- 职级定义：`HGClient/Game.cpp` 第555-572行
- 职级判断：`HGClient/Game.cpp` 第40337-40353行 (`iGetJJCRankLevel`函数)
- 增益计算：`HGServer/GlobalDef.h` 第22-25行
- 伤害应用：`HGServer/Game.cpp` 多处

---

## 二、职级与所需贡献度对照表

| 等级 | 职级名称 | 所需贡献度 | 贡献度区间 |
|:----:|:--------:|:----------:|:----------:|
| 0 | 列兵 | 0 | 0 ~ 49 |
| 1 | 军士 | 50 | 50 ~ 149 |
| 2 | 军士长 | 150 | 150 ~ 299 |
| 3 | 士官长 | 300 | 300 ~ 499 |
| 4 | 骑士守卫 | 500 | 500 ~ 799 |
| 5 | 骑士队长 | 800 | 800 ~ 1199 |
| 6 | 司令 | 1200 | 1200 ~ 1699 |
| 7 | 统帅 | 1700 | 1700 ~ 2299 |
| 8 | 元帅 | 2300 | 2300 ~ 3199 |
| 9 | 大元帅 | 3200 | 3200 ~ 4999 |
| 10 | 大元帅★ | 5000 | 5000 ~ 9999 |
| 11 | 大元帅★★ | 10000 | 10000 ~ 11999 |
| 12 | 大元帅★★★ | 12000 | 12000 ~ 20000 |

**贡献度上限：** `DEF_MAX_CONTRIBUTION = 20000`

---

## 三、增益属性详解

### 3.1 物理攻击增益

**计算公式：**
```
额外物理伤害 = 贡献度 / 4000
```

**示例计算：**
| 贡献度 | 额外物理伤害 |
|:------:|:------------:|
| 4000 | +1 |
| 8000 | +2 |
| 12000 | +3 |
| 16000 | +4 |
| 20000 | +5 |

### 3.2 魔法攻击增益

**计算公式：**
```
额外魔法伤害 = 贡献度 / 4000
```

**特殊说明：** 魔法伤害增益有 **25%概率触发**（每次攻击随机判定）

**示例计算：**
| 贡献度 | 额外魔法伤害(触发时) |
|:------:|:-------------------:|
| 4000 | +1 |
| 8000 | +2 |
| 12000 | +3 |
| 16000 | +4 |
| 20000 | +5 |

### 3.3 对负贡献度目标的额外伤害

当目标玩家贡献度为负数时（叛国者/罪犯），攻击者会获得额外伤害加成：

**计算公式：**
```
额外伤害 = |目标贡献度| / 200
最大额外伤害 = 10
```

**示例计算：**
| 目标贡献度 | 额外伤害 |
|:----------:|:--------:|
| -200 | +1 |
| -500 | +2 |
| -1000 | +5 |
| -2000及以下 | +10 (上限) |

### 3.4 对高贡献度目标的伤害减免

当攻击高贡献度目标时，目标方会获得伤害减免（等于减少攻击者的伤害）：

**计算公式：**
```
伤害减免 = 目标贡献度 / 4000
```

**示例计算：**
| 目标贡献度 | 受到伤害减少 |
|:----------:|:------------:|
| 4000 | -1 |
| 8000 | -2 |
| 12000 | -3 |
| 16000 | -4 |
| 20000 | -5 |

---

## 四、各职级增益汇总表

| 职级 | 贡献度范围 | 物理伤害加成 | 魔法伤害加成(25%概率) | 受到伤害减免 |
|:----:|:----------:|:------------:|:--------------------:|:------------:|
| 列兵 | 0-49 | +0 | +0 | -0 |
| 军士 | 50-149 | +0 | +0 | -0 |
| 军士长 | 150-299 | +0 | +0 | -0 |
| 士官长 | 300-499 | +0 | +0 | -0 |
| 骑士守卫 | 500-799 | +0 | +0 | -0 |
| 骑士队长 | 800-1199 | +0 | +0 | -0 |
| 司令 | 1200-1699 | +0 | +0 | -0 |
| 统帅 | 1700-2299 | +0 | +0 | -0 |
| 元帅 | 2300-3199 | +0 | +0 | -0 |
| 大元帅 | 3200-4999 | +0~1 | +0~1 | -0~1 |
| 大元帅★ | 5000-9999 | +1~2 | +1~2 | -1~2 |
| 大元帅★★ | 10000-11999 | +2 | +2 | -2 |
| 大元帅★★★ | 12000-20000 | +3~5 | +3~5 | -3~5 |

**注意：** 增益是连续的线性增长，职级只是称号显示，实际增益按具体贡献度计算。

---

## 五、特殊武器增益

以下武器可以**额外享受贡献度加成**（双重计算）：

### 单手武器
- **KlonessEsterk** (ID: 771)
- **KlonessWand(MS.20)** (ID: 763)
- **KlonessWand(MS.10)** (ID: 764)
- **狂暴之杖(MS.30)** (ID: 698)

### 双手武器
- **KlonessBlade** (ID: 779)
- **暴风之刃** (ID: 775)
- **毁灭之剑** (ID: 776)
- **ID: 770**

使用这些武器时，贡献度增益会被**应用两次**：一次在基础属性计算，一次在伤害计算。

---

## 六、国家差异

### 6.1 职级名称

**阿瑞登(Aresden)** 和 **爱芬(Elvine)** 两个国家：
- **职级名称：** 完全相同，无区别
- **职级判定：** 完全相同，无区别

### 6.2 增益计算

**结论：两国完全相同，无任何差异。**

贡献度系统的增益计算代码中没有对 `m_cSide`（国家）进行区分判断，所有公式和系数对两国玩家完全一致。

---

## 七、贡献度获取途径

### 📊 贡献度获取方式一览表

| 方式 | 贡献度变化 | 条件/说明 |
|:----:|:----------:|:----------|
| **国战击杀敌国玩家** | 攻击者 **+2**，被杀者 -2 | 国战模式开启时 |
| **经验PK地图击杀敌国玩家** | 攻击者 **+1**，被杀者 -1 | 非国战，经验PK地图 |
| **能量球送入己方传送门** | **+5** | 能量球活动 |
| **使用贡献石** (ItemID:159) | **+100** | 消耗道具 |
| **使用高级贡献石** (ItemID:160) | **+1000** | 消耗道具 |
| **玩家好评** | **+1** | 被其他玩家好评，20分钟冷却 |
| 能量球送入敌方传送门 | -10 | 惩罚 |
| PK同国玩家 | -1 | 杀害友军惩罚 |
| 击杀独角兽(Type 32) | -5 | 杀害神圣生物惩罚 |
| 玩家差评 | -1 | 被其他玩家差评 |
| 购买英雄装备 | -10 ~ -100 | 消费贡献度换装备 |

> ⚠️ **重要说明**：国战中摧毁建筑（城门、防御塔等）获得的是**战争贡献值(m_iWarContribution)**，**不是贡献度**！这是两个完全不同的系统。

---

### 7.1 国战相关

**国战期间贡献度变化：**

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:--------:|
| 击杀敌国玩家 | 攻击者 **+2**，被杀者 **-2** | [Game.cpp#L31756-31757](HGServer/Game.cpp#L31756-L31757) |
| 能量球送入己方传送门 | **+5** | [Game.cpp#L56541](HGServer/Game.cpp#L56541) |
| 能量球送入敌方传送门 | **-10** | [Game.cpp#L56548](HGServer/Game.cpp#L56548) |

**非国战期间(经验PK地图)：**

| 行为 | 贡献度变化 | 代码位置 |
|:----:|:----------:|:--------:|
| 击杀敌国玩家 | 攻击者 **+1**，被杀者 **-1** | [Game.cpp#L31749-31750](HGServer/Game.cpp#L31749-L31750) |

### 7.2 其他获取途径

| 行为 | 贡献度变化 | 说明 |
|:----:|:----------:|:----:|
| 使用贡献石(ItemID:159) | **+100** | 道具使用 |
| 使用高级贡献石(ItemID:160) | **+1000** | 道具使用 |
| 玩家好评评价 | **+1** | 20分钟冷却 |
| 玩家差评评价 | **-1** | 20分钟冷却 |

### 7.3 贡献度消耗（购买英雄装备）

| 装备类型 | 消耗贡献度 | 物品示例 |
|:--------:|:----------:|:--------:|
| 英雄披风 | -100 | Aresden/Elvine HeroCape |
| 英雄头盔(M/W) | -20 | HeroHelm |
| 英雄帽子(M/W) | -20 | HeroCap |
| 英雄盔甲(M/W) | -30 | HeroArmour |
| 英雄长袍(M/W) | -20 | HeroRobe |
| 英雄锁甲(M/W) | -10 | HeroHauberk |
| 英雄护腿(M/W) | -15 | HeroLeggings |

### 7.4 贡献度扣除（惩罚）

| 行为 | 贡献度变化 | 说明 |
|:----:|:----------:|:----:|
| PK同国玩家 | **-1** | 杀害同阵营玩家 |
| 击杀独角兽(Type 32) | **-5** | 神圣生物惩罚 |

---

## 八、相关数值汇总

| 参数 | 数值 | 说明 |
|:----:|:----:|:----:|
| 贡献度上限 | 20000 | 最多能积累的贡献度 |
| 贡献度下限 | -20000 | 最低可达到的贡献度 |
| 每点物理伤害需要贡献度 | 4000 | 贡献度/4000=物理伤害加成 |
| 每点魔法伤害需要贡献度 | 4000 | 贡献度/4000=魔法伤害加成(25%触发) |
| 负贡献度伤害系数 | 200 | \|负贡献度\|/200=额外受到伤害 |
| 战争贡献值上限 | 1000000 | 与荣誉值是不同的系统 |

---

## 九、贡献度与战争贡献值对比

| 属性 | 贡献度(Contribution) | 战争贡献值(WarContribution) |
|:----:|:-------------------:|:--------------------------:|
| 变量名 | `m_iContribution` | `m_iWarContribution` |
| 上限 | 20000 | 1000000 |
| 下限 | -20000 | 0 |
| 持久性 | **永久保存** | **国战开始时归零** |
| 用途 | 军衔称号、战斗增益 | 国战排名、战后奖励 |
| 获取来源 | 击杀敌国玩家、道具使用 | 国战摧毁建筑、击杀敌国玩家 |

**核心区别：**
- 贡献度是**长期积累**的军衔系统，影响战斗属性
- 战争贡献值是**单场国战**的贡献记录，用于排名和奖励

---

## 十、注意事项

1. **贡献度** (`m_iContribution`) 和 **战争贡献值** (`m_iWarContribution`) 是两个不同的系统
2. **贡献度** (`m_iContribution`) 和 **荣誉** (`m_sJJCScore`) 也是两个不同的系统
3. 贡献度可以为负数（最低-20000），负贡献度会导致被攻击时受到额外伤害
4. 魔法伤害增益只有25%概率触发，物理伤害增益是100%触发
5. 职级称号只影响显示，实际增益按具体数值连续计算
6. **国战中摧毁建筑获得的是战争贡献值，不是贡献度**
7. 贡献度通过击杀敌国玩家获取：国战期间+2，经验PK地图+1

---

*文档生成时间：2025年12月15日*
*文档更新时间：2026年1月5日*
*代码版本：基于当前工作区代码分析*
