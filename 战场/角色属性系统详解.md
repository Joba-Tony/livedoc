# 角色属性系统详解

本文档基于服务端和客户端源代码分析，提供准确的属性计算公式和实际示例。

---

### 什么是基础属性？
基础属性就是角色的"六维"数值，升级时获得3点可以自由分配。不同职业需要侧重不同的属性：
- **战士**：主加力量(打得疼) + 体质(血多抗揍)
- **法师**：主加魔力(法术强) + 智力(蓝多)
- **弓手**：主加敏捷(命中高、闪避高) + 力量

### 什么是衍生属性？
衍生属性是由基础属性"算出来"的，玩家不能直接加点。比如：
- 你的**最大血量**是由体质、力量、等级等"算"出来的
- 你的**物理伤害**是由力量和武器"算"出来的

### 一句话总结各属性作用

| 属性 | 一句话说明 | 主要受益职业 |
|------|-----------|-------------|
| 力量 | 打得疼、能扛重装备、耐力多 | 战士、弓手 |
| 体质 | 血多、回血快 | 所有职业 |
| 敏捷 | 打得准、不容易被打中 | 弓手、战士 |
| 智力 | 蓝多、能学高级魔法 | 法师 |
| 魔力 | 魔法打得疼、回蓝快 | 法师 |
| 魅力 | 创建公会、买东西便宜 | 会长 |

---

## 一、基础属性（6项）

| 属性 | 变量名 | 范围 | 说明 |
|------|--------|------|------|
| 力量 (STR) | `m_iStr` | 10-200 | 影响物理伤害、最大HP、最大SP、负重 |
| 体质 (VIT) | `m_iVit` | 10-200 | 影响最大HP、HP恢复速度 |
| 敏捷 (DEX) | `m_iDex` | 10-200 | 影响物理防御、攻击命中 |
| 智力 (INT) | `m_iInt` | 10-200 | 影响最大MP、魔法学习等级 |
| 魔力 (MAG) | `m_iMag` | 10-200 | 影响最大MP、魔法伤害 |
| 魅力 (CHR) | `m_iCharisma` | 10-200 | 影响最大HP(≤20时)、公会创建 |

### ? 通俗解释

**力量 (STR)** - 就像现实中的肌肉力量
- 力量越高，近战武器砍人越疼
- 力量越高，能背更多东西（负重）
- 力量越高，耐力条（绿条）越长，跑得更久

**体质 (VIT)** - 就像现实中的身体素质
- 体质越高，血条（红条）越长
- 体质越高，站着不动时回血越快
- **这是最直接增加血量的属性**

**敏捷 (DEX)** - 就像现实中的灵活度
- 敏捷越高，你打别人越容易命中
- 敏捷越高，别人打你越容易Miss
- 对弓手和需要闪避的玩家特别重要

**智力 (INT)** - 就像现实中的智商
- 智力越高，能学习更高级的魔法
- 智力越高，蓝条（蓝色）稍微长一点
- 主要是"门槛"属性，够用就行

**魔力 (MAG)** - 魔法的威力
- 魔力越高，放魔法打人越疼
- 魔力越高，蓝条越长
- **法师最重要的属性**

**魅力 (CHR)** - 社交能力
- 魅力20以上才能创建公会
- 魅力越高，商店买东西越便宜
- 魅力≤20时，每点魅力还能加1点血

---

## 二、衍生属性计算公式

> ? **阅读提示**：下面的公式中，"×"表示乘法，"÷"表示除法，"+"表示加法。
> 
> 例如 `VIT × 3` 的意思是"体质乘以3"，如果你体质是100，结果就是300。

### 2.1 最大生命值 (MaxHP) - 红条的上限

**通俗理解**：血条能有多长，主要看你的体质、力量和等级。

**简化公式**：
```
最大血量 ≈ 体质×3 + 等级×2 + 力量÷2 + 装备加成
```

**举例说明**：
- 一个100级的战士，体质100，力量100
- 基础血量 = 100×3 + 100×2 + 100÷2 = 300 + 200 + 50 = **550点**
- 再加上装备和技能加成，最终血量会更高

**代码位置**: `HGServer/Game.cpp` 第52259-52281行

```cpp
// 魅力 ≤ 20 时：
MaxHP = CHR × 1 + VIT × 3 + Level × 2 + STR ÷ 2 + Skill[24] × 4 + Skill[26] × 4 + MaxHPAdd

// 魅力 > 20 时：
MaxHP = VIT × 3 + Level × 2 + STR ÷ 2 + Skill[24] × 4 + Skill[26] × 4 + MaxHPAdd
```

**参数说明**:
- `Skill[24]`, `Skill[26]`: 特定技能熟练度（与HP相关的技能）
- `MaxHPAdd`: 装备、buff等提供的额外HP加成

**实际例子** (基于截图角色数据):
- STR = 1074, VIT = 152, Level = 180, CHR = 10

```
MaxHP = 10 × 1 + 152 × 3 + 180 × 2 + 1074 ÷ 2 + 技能加成 + 装备加成
      = 10 + 456 + 360 + 537 + 技能加成 + 装备加成
      = 1363 (基础) + 装备/技能加成
```

---

### 2.2 最大魔法值 (MaxMP) - 蓝条的上限

**通俗理解**：蓝条能有多长，主要看你的魔力和智力。

**简化公式**：
```
最大蓝量 = 魔力×2 + 等级×2 + 智力÷2 + 装备加成
```

**举例说明**：
- 一个100级的法师，魔力100，智力100
- 基础蓝量 = 100×2 + 100×2 + 100÷2 = 200 + 200 + 50 = **450点**

**代码位置**: `HGServer/Game.cpp` 第52284-52290行, `HGClient/Game.cpp` 第26797-26802行

```cpp
MaxMP = MAG × 2 + Level × 2 + INT ÷ 2 + MaxMPAdd
```

**实际例子** (基于截图角色数据):
- MAG = 200, INT = 222, Level = 180

```
MaxMP = 200 × 2 + 180 × 2 + 222 ÷ 2
      = 400 + 360 + 111
      = 871
```

**截图显示**: MP = 871/871 ? **公式验证正确**

---

### 2.3 最大耐力值 (MaxSP) - 绿条的上限

**通俗理解**：耐力用来跑步，力量越高跑得越久。

**简化公式**：
```
最大耐力 = 力量×2 + 等级×2
```

**举例说明**：
- 一个100级的角色，力量100
- 最大耐力 = 100×2 + 100×2 = 200 + 200 = **400点**
- 力量1000的战士：1000×2 + 100×2 = 2000 + 200 = **2200点**

**代码位置**: `HGServer/Game.cpp` 第52293-52298行, `HGClient/Game.cpp` 第26823-26828行

```cpp
MaxSP = STR × 2 + Level × 2
```

**实际例子** (基于截图角色数据):
- STR = 1074, Level = 180

```
MaxSP = 1074 × 2 + 180 × 2
      = 2148 + 360
      = 2508
```

**截图显示**: SP = 2508/2508 ? **公式验证正确**

---

### 2.4 物理防御 (DefenseRatio) - 减少被打的伤害

**通俗理解**：物理防御越高，别人砍你伤害越低，还更容易闪避攻击。

**简化公式**：
```
物理防御 = 敏捷×2 + 装备防御
```

**举例说明**：
- 敏捷100的角色：基础防御 = 100×2 = **200点**
- 敏捷208的角色（截图）：基础防御 = 208×2 = **416点**，加上装备后是483点

**代码位置**: `HGServer/Game.cpp` 第42591行

```cpp
// 基础值
DefenseRatio = DEX × 2

// 最终值
DefenseRatio = DEX × 2 + 装备防御 + 强化加成 + AddDR
```

**实际例子** (基于截图角色数据):
- DEX = 208

```
基础物理防御 = 208 × 2 = 416
最终物理防御 = 416 + 装备加成 = 483 (截图显示)
装备加成 = 483 - 416 = 67
```

---

### 2.5 攻击命中 (AttackRatio) - 打人能不能打中

**通俗理解**：命中越高，打怪打人越不容易Miss。敏捷超过50后，每多1点敏捷就多1点命中。

**简化公式**：
```
攻击命中 = 基础命中 + 装备命中 + (敏捷-50)  【敏捷超过50的部分】
```

**举例说明**：
- 敏捷208的角色：额外命中 = 208 - 50 = **158点**
- 这158点命中是"白送"的，不需要装备

**代码位置**: `HGServer/Client.cpp` 第810-816行

```cpp
// 基础命中 = 武器技能熟练度 + 装备命中
AttackRatio = HitRatio + AddAR

// DEX > 50 时额外加成
if (DEX > 50):
    AttackRatio += (DEX - 50)
```

**实际例子** (基于截图角色数据):
- DEX = 208

```
DEX额外命中 = 208 - 50 = 158
攻击命中 = 基础命中 + 158 + 装备加成 = 419 (截图显示)
```

---

### 2.6 物理伤害 (Physical Damage) - 砍人有多疼

**通俗理解**：物理伤害 = 武器伤害 × 力量加成 + 额外加成

? **重点**：力量提供的是**百分比加成**，力量越高，加成越恐怖！

**力量加成对照表**（非常重要！）：

| 力量 | 伤害加成 | 通俗解释 |
|------|----------|----------|
| 100 | +20% | 武器伤害100变120 |
| 200 | +40% | 武器伤害100变140 |
| 500 | +100% | 武器伤害100变200（翻倍！） |
| 1000 | +200% | 武器伤害100变300（3倍！） |
| 1074 | +215% | 截图中战士的加成（武器100变315） |

**这就是为什么高力量战士伤害爆炸的原因！**

**代码位置**: `HGServer/Client.cpp` 第667-808行

#### 空手攻击 (wWeaponType == 0)
```cpp
AP_SM = AP_L = iDice(1, STR ÷ 12)  // 1到(STR/12)的随机数
```

#### 近战武器攻击 (wWeaponType 1-39)
```cpp
// 基础伤害
AP = iDice(武器骰子次数, 武器骰子面数) + 武器攻击加成

// 力量加成 (百分比)
加成比例 = STR ÷ 5 ÷ 100
AP = AP × (1 + 加成比例)

// 额外加成
AP += AddPhysicalDamage  // 装备、天使等加成
AP += 药剂效果           // 攻击药剂加成
```

**力量对物理伤害影响**:
| STR | 加成比例 |
|-----|----------|
| 100 | +20% |
| 200 | +40% |
| 500 | +100% |
| 1000 | +200% |

#### 远程武器攻击 (wWeaponType >= 40)
```cpp
AP = iDice(武器骰子次数, 武器骰子面数) + 武器攻击加成
AP += iDice(1, STR ÷ 20)  // 力量小幅加成
```

---

### 2.7 魔法伤害 (Magic Damage) - 放魔法有多疼

**通俗理解**：魔法伤害 = 魔法基础伤害 × 魔力加成 + 额外加成

? **重点**：魔力也提供**百分比加成**，但比例比力量低一些。

**魔力加成对照表**：

| 魔力 | 伤害加成 | 通俗解释 |
|------|----------|----------|
| 100 | +30% | 魔法伤害100变130 |
| 200 | +60% | 魔法伤害100变160 |

**注意**：单次魔法伤害有上限，最高180点（防止太变态）

**代码位置**: `HGServer/Game.cpp` 第37933-37945行

```cpp
// 基础魔法伤害
Damage = 魔法基础伤害

// 魔力加成 (百分比)
加成比例 = MAG ÷ 3.3 ÷ 100
Damage = Damage × (1 + 加成比例)

// 额外加成
Damage += AddMagicalDamage10 ÷ 10  // 装备加成(存储时×10)
Damage += 药剂效果                  // 法伤药剂加成
```

**魔力对魔法伤害影响**:
| MAG | 加成比例 |
|-----|----------|
| 100 | +30.3% |
| 200 | +60.6% |

**伤害上限**: 单次魔法伤害上限为 **180**

---

## 三、药剂效果系统

> ? **重要说明**：攻击药剂和法伤药剂提供的是**固定数值**加成，不是百分比！
> 
> 这意味着对于高伤害玩家来说，药剂效果提升比例较小。

### 3.1 攻击药剂 (ID=479)

| 项目 | 说明 |
|------|------|
| 效果 | 增加物理伤害 |
| 加成类型 | **固定数值**（比如+20就是+20，不是+20%） |
| 持续时间 | 约4分钟 |
| 最大效果值 | 60点 |

**举例**：
- 使用20点攻击药剂
- 原本伤害135-160 → 使用后155-180
- 提升幅度：约12-15%（对高伤害玩家提升不明显）
- **效果类型**: 物理伤害加成
- **数值类型**: 固定值，非百分比
- **持续时间**: 约4分钟 (0xf0 = 240秒)
- **效果值范围**: 最大60点

```cpp
// 代码位置: HGServer/Game.cpp 第15311-15315行
if (药剂类型 == 0x01):  // 攻击药剂
    iAP_SM += 药剂效果值
    iAP_L += 药剂效果值
```

### 3.2 法伤药剂 (ID=480)

| 项目 | 说明 |
|------|------|
| 效果 | 增加魔法伤害 |
| 加成类型 | **固定数值**（比如+10就是+10，不是+10%） |
| 持续时间 | 约4分钟 |
| 最大效果值 | 60点 |

**举例**：
- 使用10点法伤药剂
- 原本魔法伤害50 → 使用后60
- 提升幅度：约20%（对低伤害魔法提升明显，对高伤害魔法提升不明显）

### ?? 为什么玩家觉得药剂效果不明显？

因为药剂是**固定数值**加成：
- 对于伤害只有50点的新手，+10就是+20%，很明显
- 对于伤害有150点的老玩家，+10只有+6.7%，几乎感觉不到

**策划建议**：如果想让药剂效果更明显，可以考虑改成百分比加成。

---

## 四、实际角色数据验证

> ? 以下数据来自实际游戏截图，用于验证公式的准确性。

### 截图角色属性

| 属性 | 数值 |
|------|------|
| 力量 (STR) | 1074 |
| 智力 (INT) | 222 |
| 体力 (VIT) | 152 |
| 敏捷 (DEX) | 208 |
| 魔力 (MAG) | 200 |
| 魅力 (CHR) | 10 |
| 等级 | 180 |

### 公式验证

| 衍生属性 | 计算值 | 截图显示 | 验证 |
|----------|--------|----------|------|
| MaxMP | 200×2 + 180×2 + 222÷2 = 871 | 871 | ? |
| MaxSP | 1074×2 + 180×2 = 2508 | 2508 | ? |
| 物理伤害 | 135-160 (含STR加成约215%) | 135-160 | ? |
| 法术伤害 | 0.0 (无魔法武器) | 0.0 | ? |
| 物理防御 | DEX×2 + 装备 = 416+67 | 483 | ? |
| 攻击命中 | 基础 + (DEX-50) + 装备 | 419 | ? |

---

## 五、属性影响汇总表（速查表）

> ? 这个表格可以快速查询"我加什么属性，能提升什么"。

| 基础属性 | 影响的衍生属性 | 计算方式 | 通俗解释 |
|----------|----------------|----------|----------|
| **力量** | MaxHP | +STR÷2 | 力量100加50血 |
| | MaxSP | +STR×2 | 力量100加200耐力 |
| | 物理伤害 | +(STR÷5)% | 力量100加20%伤害 |
| **体质** | MaxHP | +VIT×3 | 体质100加300血（**最高效！**） |
| **敏捷** | 物理防御 | +DEX×2 | 敏捷100加200防御 |
| | 攻击命中 | +(DEX-50) | 敏捷100加50命中 |
| **智力** | MaxMP | +INT÷2 | 智力100加50蓝 |
| **魔力** | MaxMP | +MAG×2 | 魔力100加200蓝 |
| | 魔法伤害 | +(MAG÷3.3)% | 魔力100加30%魔伤 |
| **魅力** | MaxHP | +CHR×1 | 魅力20以下时，每点加1血 |

### ? 加点建议

**想要血多**：优先加体质（1点体质=3血），其次力量（1点力量=0.5血）

**想要物理伤害高**：加力量（百分比加成，越到后面越恐怖）

**想要魔法伤害高**：加魔力（百分比加成）

**想要蓝多**：优先加魔力（1点魔力=2蓝），其次智力（1点智力=0.5蓝）

**想要命中/防御**：加敏捷（1点敏捷=2防御，超过50后每点还加1命中）

---

## 六、代码文件索引

| 功能 | 文件路径 | 行号 |
|------|----------|------|
| MaxHP计算 | HGServer/Game.cpp | 52259-52281 |
| MaxMP计算 | HGServer/Game.cpp | 52284-52290 |
| MaxSP计算 | HGServer/Game.cpp | 52293-52298 |
| 物理伤害计算 | HGServer/Client.cpp | 667-808 |
| 魔法伤害计算 | HGServer/Game.cpp | 37933-37945 |
| 属性初始化 | HGServer/Game.cpp | 42580-42630 |
| 攻击药剂效果 | HGServer/Game.cpp | 15308-15315 |
| 法伤药剂效果 | HGServer/Game.cpp | 37942-37945 |

---

*文档生成日期: 2026年1月23日*
*数据来源: 服务端源代码 (HGServer) 和客户端源代码 (HGClient)*
